jobs:
- job: Linux
  pool:
    vmImage: 'ubuntu-20.04'
  variables:
    buildConfiguration: 'Release'
  steps:
  - task: UseDotNet@2
    displayName: 'Install .NET 6 SDK'
    inputs:
      packageType: 'sdk'
      version: '6.0.x'
      performMultiLevelLookup: true
  - script: cd $(Build.SourcesDirectory) && bash ./build.sh
    displayName: 'Linux Build and Tests'
  - task: PublishTestResults@2
    inputs:
      testRunner: VSTest
      testResultsFiles: '**/*.trx'

- job: Windows
  pool:
    vmImage: 'windows-2022'
  variables:
    buildConfiguration: 'Release'
  steps:
  - script: cd $(Build.SourcesDirectory) && powershell -ExecutionPolicy Unrestricted ./build.ps1 --full
    displayName: 'Windows Full Build and Tests'
  - task: PublishTestResults@2
    inputs:
      testRunner: VSTest
      testResultsFiles: '**/*.trx'
  - task: PublishCodeCoverageResults@1
    inputs:
      summaryFileLocation: $(Build.SourcesDirectory)\artifacts\coverage.cobertura.xml
      reportDirectory: $(Build.SourcesDirectory)\artifacts
      codecoverageTool: cobertura
